---
title: "IC Compiler II - 14 Via Ladder Flow"
excerpt: "Block-level Implementation"
date: 2023-05-20 09:00:00 +0900
header:
  overlay_image: /assets/images/unsplash-Umberto.jpg
  overlay_filter: 0.5
  caption: "Photo by [**Umberto**](https://unsplash.com/@umby) on [**Unsplash**](https://unsplash.com/)"
categories:
  - IC Compiler II
---

## Objectives

- Describe the three types of via ladders and when each is needed
- Configure IC Compiler 11 to implement the via ladder flow
  - Using via ladder rules and association files provided by your library vendor

## 1. IC Compiler II Flow

![2023-05-20-icc2-flow-via-ladder.png]({{site.baseurl}}/assets/images/2023-05-20-icc2-flow-via-ladder.png){: .align-center}  

As you will see, the via ladder flow affects all phases of the RTL-to-GDS flow, starting with `place_opt`, through `clock_opt`, `route_auto`, and `route_opt`. The setup steps to enable the via ladder flow must therefore be applied before synthesizing the RTL!  
비아 래더 플로우는 `place_opt`, `clock_opt`, `route_auto`, `route_opt`를 포함한 RTL-to-GDS 플로우의 여러 단계에 영향을 미칩니다. 따라서 비아 래더 플로우를 활성화하기 위한 설정 단계는 RTL 합성 이전에 적용되어야 합니다!  
{: .notice--warning}  

## 2. What is a Via Ladder(VL)?

![2023-05-20-what-is-vl.png]({{site.baseurl}}/assets/images/2023-05-20-what-is-vl.png){: .align-center}  

Let's start by describing what a via ladder is. Via ladders are a better alternative to redundant via insertion or RVI techniques, to better address the routing challenges of connecting to standard cell or macro pins in today's advanced technology nodes. By the way, by redundant via insertion I mean either the substitution of a single small via with another single via with a larger contact area, and/or with a multiple via array.Each via ladder is built or created on-the-fly by the router when being inserted - they are not pre-existing structures. As you can see from the picture here, a via ladder is comprised of parallel route segments that connect the pin layer of a standard cell or macro to the actual route shape. Two of the main challenges of pin routing in today's technologies are the fact that routing jogs in the non-preferred direction are commonly not allowed on the lower metal layers, and pin shapes are placed very close to each other resulting in high pin density. Both of these constraints make it more difficult for the router to efficiently implement traditional RVI techniques at cell pins, whereas via ladders can overcome these challenges. Here is another benefit of via ladders over RVI: In this picture, let's focus on the purple metal-3 route segments. Now imagine that a P/G preroute on metal-3 exists along one or more routing tracks which, ideally, would be occupied by the purple via ladder route segments shown here. Well, since the via ladder is built on the fly, the router can spread the two purple route segments apart to accommodate the P/G pre-route, while still building an effective via ladder. That is a huge advantage over RVI!  
먼저, 비아 래더에 대해 설명하겠습니다. 비아 래더는 오늘날의 고급 기술 노드에서 표준 셀이나 매크로 핀에 연결하기 위한 라우팅 도전에 대한 더 나은 대안입니다. 여기서 말하는 중복 비아 삽입이란 작은 비아를 더 큰 접촉 면적을 가진 다른 단일 비아로 대체하거나, 여러 비아 배열로 대체하는 기법을 의미합니다. 각 비아 래더는 라우터가 삽입할 때 생성되는 것으로, 사전에 존재하는 구조는 아닙니다. 이 그림에서 볼 수 있듯이, 비아 래더는 표준 셀이나 매크로의 핀 레이어를 실제 라우트 모양에 연결하는 평행한 라우트 세그먼트로 구성됩니다. 오늘날의 기술에서 핀 라우팅의 주요 도전 요소는 하위 금속 레이어에서 비선호 방향으로의 라우트 조각이 허용되지 않는다는 점과 핀 모양이 서로 아주 가깝게 배치되어 핀 밀도가 높다는 점입니다. 이러한 제약 사항으로 인해 라우터는 효율적으로 전통적인 중복 비아 삽입 기법을 셀 핀에 구현하기가 더 어려워지지만, 비아 래더는 이러한 도전을 극복할 수 있습니다. 비아 래더의 또 다른 장점은 중복 비아 삽입에 비해입니다. 이 그림에서 보라색 금속-3 라우트 세그먼트에 초점을 맞추어 봅시다. 이제, 이 그림에 표시된 보라색 비아 래더 라우트 세그먼트들이 차지해야 할 이상적으로 P/G 프리라우트가 있는 금속-3 상의 하나 이상의 라우팅 트랙이 존재한다고 상상해 봅시다. 비아 래더는 현장에서 생성되므로, 라우터는 P/G 프리라우트를 수용하기 위해 두 개의 보라색 라우트 세그먼트를 분리하여 효과적인 비아 래더를 구성할 수 있습니다. 이는 중복 비아 삽입에 비해 큰 장점입니다!  
{: .notice--warning}  

## 3. Multiple Purposes and Types of Via Ladders

![2023-05-20-types-of-vl.png]({{site.baseurl}}/assets/images/2023-05-20-types-of-vl.png){: .align-center}  

Strictly speaking, there are two purposes for via ladders, and correspondingly two types of via ladders: Via ladders used to improve timing, which we call performance via ladders, and via ladders which improve electro-migration or EM robustness, which we call EM via ladders. There is a 3rd type called pattern-must-join or PMJ, which applies to multi-terminal library cell pins that rely on the router to interconnect them, as depicted here on the right. PMJs are technically not via ladder structures, but since PMJ connections are implemented as part of the via ladder flow, we consider PMJs as a 3rd type of, quote, via ladder. Let's discuss each via ladder in more detail, starting with performance via ladders. As summarized in the first column here, performance via ladders are used to improve timing on critical nets, as determined by the timer during optimization. They are targeted at critical instance pins, and are inserted opportunistically, only if and where needed. If you look at the pictures of the three via ladder structures, you will notice that performance via ladders are the most aggressive and route-intensive of the three types, meaning, they occupy more metal layers which result in larger stacks. This is because performance via ladders generally take advantage of the lower resistance of the higher metal layers for delay or performance improvement. Performance via ladder insertion is not ON by default. You need to explicitly enable this, which I will cover shortly. EM via ladders are used to improve electro-migration robustness. They are, typically, less aggressive and route intensive than performance via ladders. That's because only the lower metal layers, for example M1 through M3, are most susceptible to EM, therefore, the stack does not have to be so high. EM via ladders are mandatory and are inserted based on a key attribute definition on each cell library pin that has an EM via ladders requirement. Any EM pin without an EM via ladder is reported as a physical DRC violation. Both performance and EM via ladders require via ladder rules and association definitions, which are commonly provided as separate TCL files by your library provider. Pattern-must-join or PMJ via ladders are mandatorily inserted in order to complete multi-terminal connections of PMJ-designated library cell pins. PMJ via ladders also improve electro-migration robustness. PMJs do not require any additional rules and association inputs files - they are inserted based strictly on library cell pin attribute definitions. When a PMJ via ladder is inserted, the router drops one via per pin shape, as depicted here by a single yellow via on top of each blue terminal shape, then draws a single, short, straight, shape on the next higher layer to connect the individual vias, depicted by the pink horizontal shape. Another advantage of PMJ via ladders is that the router can move the location of that connecting route if another shape is in the way. In the picture shown here, imagine the pink route being moved forward or backward, with the corresponding vias below moving closer to the front or rear edges of the blue terminal shapes. Lastly, as you can clearly see, PMJ via ladders are the least aggressive and route-intensive of the three types of via ladders.  
엄밀히 말하자면, 비아 래더에는 두 가지 목적과 그에 따라 두 가지 유형이 있습니다: 타이밍을 개선하기 위해 사용되는 비아 래더(성능 비아 래더)와 전기이동(Electro-Migration, EM) 견고성을 향상시키기 위해 사용되는 비아 래더(EM 비아 래더)입니다. 또한 PMJ(Pattern-Must-Join)라고 불리는 3번째 유형이 있으며, 라우터가 이들을 상호 연결하는 데 의존하는 다중터미널 라이브러리 셀 핀에 적용됩니다. PMJ는 엄밀히 말해 비아 래더 구조는 아니지만, PMJ 연결은 비아 래더 플로우의 일부로 구현되기 때문에, PMJ를 "비아 래더"의 세 번째 유형으로 간주합니다. 이제 각 비아 래더에 대해 자세히 설명해 보겠습니다. 먼저 성능 비아 래더부터 시작하겠습니다. 이 그림의 첫 번째 열에서 요약된 대로, 성능 비아 래더는 최적화 중에 타이머에 의해 식별된 중요한 넷의 타이밍을 개선하기 위해 사용됩니다. 주로 중요한 인스턴스 핀을 대상으로 하며, 필요한 경우에만 기회주의적으로 삽입됩니다. 세 가지 비아 래더 구조의 그림을 살펴보면, 성능 비아 래더가 세 가지 유형 중 가장 적극적이고 라우트가 밀집한 것을 알 수 있습니다. 즉, 더 많은 금속 레이어를 차지하고 스택이 크게 형성됩니다. 이는 성능 비아 래더가 일반적으로 지연 또는 성능 개선을 위해 상위 금속 레이어의 저항이 낮은 부분을 활용하기 때문입니다. 성능 비아 래더 삽입은 기본적으로 활성화되어 있지 않습니다. 명시적으로 활성화해야 하며, 곧 다루도록 하겠습니다. EM 비아 래더는 전기이동(EM) 견고성을 향상시키기 위해 사용됩니다. 일반적으로 성능 비아 래더보다는 적극적이지 않고 라우트가 밀집하지 않습니다. 이는 낮은 금속 레이어(M1에서 M3까지)가 EM에 가장 민감하므로, 스택이 그리 높지 않아도 된다는 것을 의미합니다. EM 비아 래더는 필수적이며, 각 셀 라이브러리 핀에 EM 비아 래더 요구 사항을 정의하는 주요 속성에 따라 삽입됩니다. EM 비아 래더가 없는 EM 핀은 물리적인 DRC 위반으로 보고됩니다. 성능 및 EM 비아 래더는 일반적으로 라이브러리 제공업체가 별도의 TCL 파일로 제공하는 비아 래더 규칙과 연결 정의가 필요합니다. 마지막으로, PMJ(Pattern-Must-Join) 비아 래더는 PMJ 지정 라이브러리 셀 핀의 다중터미널 연결을 완료하기 위해 필수적으로 삽입됩니다. PMJ 비아 래더도 전기이동 견고성을 개선합니다. PMJ는 추가적인 규칙과 연결 입력 파일이 필요하지 않으며, 엄격하게 라이브러리 셀 핀의 속성 정의에 따라 삽입됩니다. PMJ 비아 래더가 삽입되면, 라우터는 핀 모양 당 하나의 비아를 제거한 후, 개별 비아를 연결하는 단일 짧은 직선 모양을 다음 높은 레이어에 그립니다. 또한 PMJ 비아 래더의 장점 중 하나는 라우터가 해당 연결 경로의 위치를 이동시킬 수 있다는 것입니다. 이 그림에서, 핑크색 경로가 앞이나 뒤로 이동하고, 해당하는 비아가 파란색 터미널 모양의 전면이나 후면으로 이동하는 것을 상상해 보세요. 마지막으로 분명히 볼 수 있듯이, PMJ 비아 래더는 세 가지 유형의 비아 래더 중 가장 적극적이고 라우트가 밀집하지 않은 형태입니다.  
{: .notice--warning}  

## 4. Required Data Input for VL Implementation

- Each cell pin requiring an EM or PMJ VL is marked by a key library pin attribute
- Performance and EM VLs require VL rules and association Tcl files to be loaded by the user
  - Rules file defines the different structures that are possible
  - Association file defines the particular structures allowed for each library cell pin
- Usually provided by your library vendor or group, otherwise IC Compiler 11 provides a utility to automatically generate the files
- PMJ VLs do not require any additional user data input

As mentioned on the previous page, EM and PMJ via ladders are mandatory, and will be reported as a physical DRC violation if not inserted. Each library cell pin which requires an EM and/or PMJ via ladder is marked as such by a key library pin attribute. If a pin requires both an EM and a PMJ via ladder, that pin will have both attributes. These attributes are included in the CLIB reference libraries - no user input is needed to define EM or PMJ via ladders requirements. Performance and EM via ladders, do, however, require additional input data to be loaded or sourced by the user: a rules file and an association file. The rules file defines all possible via ladder structures that can be built for performance and for EM via ladders. Each structure is defined by its top metal layer, as well as the specific number of parallel route segments per metal layer. The more complex via ladder structures connect to a higher top metal layer, and/or use a larger number of parallel route segments. Only one via is inserted to connect horizontal and vertical route segment intersections. Each via ladder structure is assigned a name, which will be referred to in the association file. Typically, the smaller structures are available for both performance and EM via ladders, and the more complex or larger structures are used only for performance via ladders, to take advantage of their lower resistance. This via ladder purpose (either performance, or EM or both) is also part of the structure definition. The association file defines which of the various via ladder structures that are defined in the rules files are allowed for each library cell pin. You can see an example of both of these files in the notes. These rules and association files are usually provided by your library vendor or library group, but if not, the tool provides a utility that can automatically derive most of these files for you, based on your design library's specified CLIBs and tech file - no additional user input is required. The command to launch this utility is shown in the notes. This utility creates both rules and associations for performance VLs, but only the rules for EM VLs: The user will need to create their own EM association file. PMJ via ladders do not require any additional input from the user - they are defined only by their library pin attribute, and will be connected by the router as required.  
이전 페이지에서 언급한 대로, EM 및 PMJ 비아 래더는 필수적이며, 삽입되지 않을 경우 물리적인 DRC 위반으로 보고됩니다. EM 및/또는 PMJ 비아 래더가 필요한 각 라이브러리 셀 핀은 주요 라이브러리 핀 속성에 의해 해당되는 핀으로 표시됩니다. 만약 핀이 EM 및 PMJ 비아 래더 모두를 필요로 한다면, 해당 핀은 두 가지 속성을 모두 가질 것입니다. 이러한 속성들은 CLIB 참조 라이브러리에 포함되어 있으며, EM 또는 PMJ 비아 래더 요구 사항을 정의하기 위해 사용자 입력이 필요하지 않습니다. 그러나 성능 및 EM 비아 래더는 사용자가 추가 입력 데이터를 로드하거나 소스로 지정해야 합니다. 규칙 파일과 연관 파일입니다. 규칙 파일은 성능 및 EM 비아 래더를 위해 구축될 수 있는 모든 비아 래더 구조를 정의합니다. 각 구조는 상위 금속 레이어와 금속 레이어 당 특정 수의 병렬 라우트 세그먼트로 정의됩니다. 더 복잡한 비아 래더 구조는 더 높은 상위 금속 레이어에 연결되거나 더 많은 병렬 라우트 세그먼트를 사용합니다. 수평 및 수직 라우트 세그먼트 교차점에 연결하기 위해 하나의 비아만 삽입됩니다. 각 비아 래더 구조에는 이름이 할당되며, 이 이름은 연관 파일에서 참조됩니다. 일반적으로, 더 작은 구조는 성능 및 EM 비아 래더 모두에 사용되고, 더 복잡하거나 큰 구조는 성능 비아 래더에만 사용되어 저항이 낮은 특성을 활용합니다. 이 비아 래더 목적(성능 또는 EM 또는 둘 다)은 구조 정의의 일부입니다. 연관 파일은 규칙 파일에서 정의된 다양한 비아 래더 구조 중 어느 것이 각 라이브러리 셀 핀에 허용되는지를 정의합니다. 참고 사항에서 이 두 파일의 예시를 볼 수 있습니다. 이러한 규칙 및 연관 파일은 일반적으로 라이브러리 공급 업체나 라이브러리 그룹에서 제공되지만, 그렇지 않은 경우 도구는 사용자의 지정된 CLIB 및 기술 파일에 기반하여 대부분의 파일을 자동으로 생성하는 유틸리티를 제공합니다. 사용자 추가 입력이 필요하지 않습니다. 이 유틸리티를 실행하기 위한 명령은 참고 사항에 표시되어 있습니다. 이 유틸리티는 성능 VL을 위한 규칙과 연관을 생성하지만, EM VL을 위한 규칙만 생성합니다. EM 연관 파일은 사용자가 직접 생성해야 합니다. PMJ 비아 래더는 사용자로부터 추가 입력을 필요로하지 않으며, 라이브러리 핀 속성에 의해서만 정의되며 라우터에 의해 필요한 대로 연결됩니다.  
{: .notice--warning}  

## 5. Via Ladder Implementation Flow

![2023-05-20-vl-implementation-flow.png]({{site.baseurl}}/assets/images/2023-05-20-vl-implementation-flow.png){: .align-center}  

Let's now take a look at the via ladder implementation flow, to better understand exactly what via ladder steps are performed during the various phases of the design flow. During physical synthesis with compile_fusion, the timing-critical pins are identified, and an appropriate sub-set of performance via ladder candidates are assigned to each critical pin. This assignment is applied through an instance pin attribute, and the subsequent via ladder insertion step must follow these assignments. Timing analysis incorporates estimated RC information based on these assigned VLs, for more accurate pre-route timing estimation. This sub-set assignment applies only to performance via ladders, not to EM or PMJ via ladders. EM via ladder insertion can chose among all the via ladders associated with a pin, and PMJs connections are routed based only on their library pin attribute. Continuing on with the clock tree synthesis phase, during the route_clock stage of clock_opt, performance via ladders are built or inserted on clock pins of critical timing paths, and EM and/or PMJ via ladders are also inserted on non-critical clock pins, as required. Note that in most cases, a performance via ladder will also serve the purpose of any EM or PMJ requirement on the same pin, which is why I made the point that EM and PMJ type via ladders are inserted on non-timing critical clock pins. Performance or EM via ladder insertion generally builds the largest of the allowed or associated via ladder structures that meets the physical DRCs for each pin. This provides the best timing or EM robustness. The final_opto stage of clock_opt performs another round of performance via ladder assignments on timing-critical signal pins. Moving on to signal routing with route_auto, during this phase, performance and EM via ladders are inserted on signal pins. The router also inserts, or more precisely, makes PMJ connections, where needed. During post-route logic optimization, performance and EM assignments are applied to any newly inserted signal cell pins, as needed, and the via ladders are inserted during ECO routing to these pins.  
이제 via 래더 구현 흐름을 살펴보겠습니다. 이를 통해 설계 흐름의 각 단계에서 어떤 via 래더 단계가 수행되는지 정확히 이해할 수 있습니다. compile_fusion을 사용한 물리적 휘소 단계에서는 타이밍 중요한 핀들이 식별되고, 각 중요 핀에 적합한 성능 via 래더 후보들의 하위 집합이 할당됩니다. 이 할당은 인스턴스 핀 속성을 통해 적용되며, 이후 via 래더 삽입 단계는 이러한 할당을 따라야 합니다. 타이밍 분석은 할당된 via 래더를 기반으로 예상 RC 정보를 포함하여 더 정확한 사전 라우팅 타이밍 측정을 수행합니다. 이 하위 집합 할당은 성능 via 래더에만 적용되며, EM 또는 PMJ via 래더에는 적용되지 않습니다. EM via 래더 삽입은 핀과 관련된 모든 비아 래더 중에서 선택할 수 있으며, PMJ 연결은 라이브러리 핀 속성에만 기반하여 라우팅됩니다. clock_opt의 route_clock 단계에서는 타이밍 경로의 클럭 핀에 성능 via 래더가 구축되거나 삽입되며, 필요에 따라 EM 또는 PMJ via 래더도 비-크리티컬 클럭 핀에 삽입됩니다. 대부분의 경우 성능 via 래더는 동일한 핀에 대한 EM 또는 PMJ 요구 사항도 충족시키므로, EM 및 PMJ 타입의 비아 래더는 비-타이밍 크리티컬 클럭 핀에 삽입됩니다. 성능 또는 EM via 래더 삽입은 핀당 물리적인 DRC를 충족하는 허용되거나 연관된 via 래더 구조 중 가장 큰 구조를 구축합니다. 이는 최상의 타이밍 또는 EM 견고성을 제공합니다. route_auto를 사용한 신호 라우팅 단계에서는 신호 핀에 성능 및 EM via 래더가 삽입됩니다. 라우터는 필요한 위치에 PMJ 연결을 생성합니다. 후처리 논리 최적화 단계에서는 필요한 경우 새롭게 삽입된 신호 셀 핀에 대해 성능 및 EM 할당이 적용되며, 이러한 핀에 대해 ECO 라우팅 중에 via 래더가 삽입됩니다.  
{: .notice--warning}  

## 6. Enabling the Via Ladder Implementation Flow

- VL rules and association Tcl files must be loaded
- VLimplementation flow is automatically enabled by
- Performance VL insertion is not on-by-default — must be explicitly enabled

```tcl
# Load rules + association files for performance and EM VLs:
source VL_rules.tcl; source VL_association.tcl
# Specify technology node:
set_technology -node 7
# Enable performance VL flow:
set_app_option -name opt.common.enable_via_ladder_insertion \
               -value true

compile_fusion; ... clock_opt; ... route_auto; ... route_opt

# Report associations on instance pins
report_via_ladder_constraints -all -pin <pin_name>
# Report inserted VL on instance pins
get_via_ladder -of <pin_name>
```

As we saw from the flow diagram, via ladder implementation begins at the physical synthesis phase, so it is important to enable via ladder implementation before executing the `compile_fusion` command. The first step is to load the rules and association Tcl files. Next, the via ladder implementation flow is automatically enabled by the `set_technology -node` command. The command applies the correct via ladder settings for your specific technology, however, this will enable only EM and PMJ via ladder implementation. Performance via ladder implementation must be explicitly enabled by setting the application option `opt.common.enable_via_ladder_insertion` to true. Now you are ready to execute physical synthesis through post-route optimization. After each design phase, for example after synthesis, or after CTS, you can report via ladder assignments and insertion details on specific pins using the `report_via_ladder_constraints` and the `get_via_ladder` commands, respectively. There are example outputs of these commands in the notes.  
플로우 다이어그램에서 볼 수 있듯이, via 래더 구현은 물리적 합성 단계에서 시작되므로, `compile_fusion` 명령을 실행하기 전에 반드시 via 래더 구현을 활성화해야 합니다. 첫 번째 단계는 rules 및 association Tcl 파일을 로드하는 것입니다. 그 다음, via 래더 구현 플로우는 `set_technology -node` 명령으로 자동으로 활성화됩니다. 이 명령은 해당 기술에 대한 올바른 via 래더 설정을 적용합니다. 그러나 이는 EM 및 PMJ via 래더 구현만 활성화합니다. 성능 via 래더 구현을 활성화하려면 `opt.common.enable_via_ladder_insertion` 응용 프로그램 옵션을 true로 설정해야 합니다. 이제 물리적 합성부터 후처리 최적화까지 실행할 준비가 되었습니다. 각 설계 단계, 예를 들어 합성 후나 CTS 후에는 `report_via_ladder_constraints` 명령과 `get_via_ladder` 명령을 사용하여 특정 핀에 대한 via 래더 할당 및 삽입 세부 정보를 보고할 수 있습니다. 이와 관련된 명령의 예시 출력이 노트에 있습니다.  
{: .notice--warning}  
